#eJPT #INE #VulnerabilityAssesement


| COMMAND        | FUNCTION                                                  |
| -------------- | --------------------------------------------------------- |
| *searchsploit* | Search exploit db                                         |
| *davtest*      | Used to scan, authenticate and exploit a WebDAV server.   |
| *cadaver*      | Cadaver supports multiple interactions on WebDAV servers. |

# Windows History

● **Microsoft Windows is the dominant operating system worldwide** with a market share >=70% as of 2021.
● The popularity and deployment of Windows by individuals and companies makes it a prime target for attackers given the threat surface.
● Over the last 15 years, Windows has had its fair share of severe vulnerabilities, ranging from *MS08-067(Conflicker)* to *MS17-010 (EternalBlue)*.

By default, *Windows is not configured to run securely* and require a proactive implementation of security practices in order to configure Windows to run securely.

#### Types of Windows Vulnerabilities

● **Information disclosure** - Vulnerability that allows an attacker to access confidential data.

● **Buffer overflows** - Caused by a programming error, allows attackers to write data to a buffer and overrun the allocated buffer, consequently writing data to allocated memory addresses.

● **Remote code execution** - Vulnerability that allows an attacker to remotely execute code on the target system.

● **Privilege** escalation - Vulnerability that allows an attacker to elevate their privileges after initial compromise.

● **Denial of Service (DOS)** - Vulnerability that allows an attacker to consume a system/host’s resources (CPU, RAM, Network etc) consequently preventing the system from functioning normally.

## Frequently exploited Windows services

| Protocol/Service                                   | Ports              | Purpose                                                                                                                                                       |
| -------------------------------------------------- | ------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Microsoft IIS (Internet Information<br>Services)   | TCP ports 80/443   | Proprietary web server software developed by Microsoft that runs on Windows.                                                                                  |
| WebDAV (Web Distributed Authoring &<br>Versioning) | TCP ports 80/443   | HTTP extension that allows clients to update, delete, move and copy files on a web server. WebDAV is used to enable a web server to act as a file server.<br> |
| SMB/CIFS (Server Message Block<br>Protocol)        | TCP port 445       | Network file sharing protocol that is used to facilitate the sharing of files and peripherals between computers on a local network (LAN).                     |
| RDP(Remote Desktop Protocol)                       | TCP port 3389      | Proprietary GUI remote access protocol developed by Microsoft and is used to remotely authenticate and interact with a Windows system.                        |
| WinRM (Windows Remote Management Protocol)         | TCP ports 5986/443 | Windows remote management protocol that can be used to facilitate remote access with Windows systems.                                                         |

---

# Linux History

Linux is a free and open source operating system that is comprised of the **Linux kernel,** which was developed by Linus Torvalds, and **the GNU toolkit**, which is a collection of software and utilities that was started and developed by Richard Stallman.

● This combination of open source software is what makes up the Linux OS as a whole, and it is *commonly referred to as GNU/Linux.*

● Linux has various use cases, however, it is typically deployed as a server operating system. For this reason, there are specific services and protocols that will typically be found running on a Linux server.

● Having a good understanding of what these services are, how they work and their potential vulnerabilities is a **vitally important skill** to have as a penetration tester.

## Frequently exploited Linux services

| Protocol/Service             | Ports            | Purpose                                                                                                                                                                         |
| ---------------------------- | ---------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Apache Web Server            | TCP ports 80/443 | Free and open source cross-platform web server released under the Apache License 2.0. Apache accounts for over 80% of web servers.                                              |
| SSH (Secure Shell)           | TCP ports 22     | SSH is a cryptographic remote access protocol that is used to remotely access and control systems over an unsecured network. SSH was developed as a secure successor to telnet. |
| FTP (File Transfer Protocol) | TCP port 21      | FTP (File Transfer Protocol) is a protocol that uses TCP port 21 and is used to facilitate file sharing between a server and client/clients and vice versa.                     |
| SAMBA                        | TCP port 445     | Samba is the Linux implementation of SMB, and allows Windows systems to access Linux shares and devices.                                                                        |

---
# Exploiting with Metasploit

db_autopwn : https://github.com/hahwul/metasploit-autopwn

can be installed and loaded in metasploit

---
# Microsoft IIS Service

*IIS (Internet Information Services) is a proprietary extensible web server software developed by Microsoft* for use with the Windows NT family.

● It can be used to host websites/web apps and provides administrators with a robust GUI for managing websites.
● IIS can be used to host both static and dynamic web pages developed in ASP.NET and PHP.
● Typically configured to run on ports 80/443.
● Supported executable file extensions:
+ .asp
+ .aspx
+ .config
+ .php

---
  
# WebDAV Service

*WebDAV (Web-based Distributed Authoring and Versioning) is a set of extensions to the HTTP protocol which allow users to collaboratively edit and manage files on remote web servers.*

● WebDAV essentially enables a web server to function as a file server for collaborative authoring.
● WebDAV runs on top Microsoft IIS on ports 80/443.
● In order to connect to a WebDAV server, you will need to provide legitimate credentials. This is because WebDAV implements authentication in the form of a username and password

The first step of the exploitation process will involve **identifying whether WebDAV has been configured to run on the IIS web server.**
- We can perform a brute-force attack 
- After obtaining legitimate credentials, we can authenticate with the WebDAV server and upload a malicious *.asp* payload 

**Nmap:**
- use http_enum script to get info about webDAV

**davtest:**
- Test possible file uploads and execution
```bash
davtest -auth USERNAME:PASSWORD -url URL/webdav
```

**cadaver:**
- upload webshell
- kali path to webshells : `/usr/share/webshells`
```bash
cadaver URL/webdav
dav> put WEBSHELL_PATH
```

---
# Pass the Hash Attacks

*Pass-the-hash* is an exploitation technique that involves capturing or harvesting **NTLM hashes** or clear-text passwords and utilizing them to authenticate with the target legitimately.

+ We can use multiple tools to facilitate a Pass-The-Hash attack:
	+ *Metasploit PsExec module*
	+ *Crackmapexec*

+ This technique will allow us to **obtain access to the target system via legitimate credentials** as opposed to obtaining access via service exploitation.

#### Using Metasploit 

1. Once you have a meterpreter session, migrate to privileged process and dump hash (kiwi or hashdump)
2. Use the psexec module
```bash
msf>use exploit/windows/smb/psexec
# Set options: Rhost, SMBuser, SMBpass, target
```
3. Exploit

#### Using crackmapexec

```bash
crackmapexec smb TARGET_IP -u USERNAME -H "NT_HASH" -x "COMMAND"
```

---
# Vulnerability Scanning

## Scanning with Nessus

*Nessus is a proprietary vulnerability scanner developed by Tenable.*

+ We can utilize Nessus to perform a **vulnerability scan on a target system**, after which, we can **import the Nessus results in to MSF** for analysis and exploitation.

+ Nessus *automates the process of identifying vulnerabilities* and also provides us with information pertinent to a vulnerability like the CVE code.

+ We can use the free version of Nessus (Nessus Essentials), which allows us to scan up to 16 IPs.

## Scanning with WMAP

WMAP is a powerful, feature-rich *web application vulnerability scanner* that can be used to *automate web server enumeration and scan web applications for vulnerabilities*.

+ WMAP is available as an **MSF plugin and can be loaded directly into MSF**.

+ WMAP is **fully integrated with MSF, which consequently allows us to perform web app vulnerability scanning from within the MSF**.

1. Load the plugin : `msf> load wmap`
2. Add target to sites `msf>wmap_sites -a TARGET_IP`
3. Add target to target section`msf>wmap_target -a http://TARGET_IP`
4. Check if everrything is configured `-l`
5. Check selected modules `msf>wmap_run -t`
6. Start the scan `msf>wmap_run -e`