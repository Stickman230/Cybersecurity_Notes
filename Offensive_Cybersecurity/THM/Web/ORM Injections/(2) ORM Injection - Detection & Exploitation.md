
# SQL Injection VS ORM Injection

SQL injection and ORM injection are both techniques used to exploit vulnerabilities in database interactions, but they target different levels of the stack:

- **SQL injection**: Targets raw SQL queries, allowing attackers to manipulate SQL statements directly. This is typically achieved by injecting malicious input into query strings. The injection part in the following query, `OR '1'='1`, always evaluates to true, allowing attackers to bypass authentication:

```php
SELECT * FROM users WHERE username = 'admin' OR '1'='1';
```

- **ORM injection**: Targets the ORM framework, exploiting how it constructs queries from object operations. Attackers manipulate the ORM’s methods and properties to influence the resulting SQL queries.

```php
$userRepository->findBy(['username' => "admin' OR '1'='1"]);
```

# Testing ORM Injection

- **Manual code review**: A thorough source code inspection can reveal raw query methods (such as `whereRaw()` in Laravel) that incorporate user inputs directly. Look for concatenated strings or unescaped inputs in ORM methods, which can indicate injection points.

- **Automated scanning**: Use security scanning tools that are designed to detect ORM injection vulnerabilities. These tools analyze the codebase to identify patterns that could lead to injection, such as dynamic query construction or improper input handling.

- **Input validation testing**: Perform manual testing by injecting payloads into application inputs to see if they affect the underlying ORM query. For example, injecting SQL control characters or keywords to determine if they alter the execution of the query.

- **Error-based testing**: Enter deliberately incorrect or malformed data to trigger errors. Detailed error messages can provide insights into the structure of the underlying queries and indicate potential vulnerabilities.

## Frameworks and ORM Injection Testing

|   |   |   |
|---|---|---|
|**Framework  <br>**|**ORM Library  <br>**|**Common Vulnerable Methods  <br>**|
|Laravel|Eloquent ORM|`whereRaw(), DB::raw()`|
|Ruby on Rails|Active Record|`where("name = '#{input}'")`|
|Django|Django ORM|`extra()`, `raw()`|
|Spring|Hibernate|`createQuery()` with `concatenation`|
|Node.js|Sequelize|`sequelize.query()`|

**Techniques to Identify the Framework**

- **Verifying cookies**
- **Reviewing source code**: Look through the HTML source code for comments, meta tags, or any embedded scripts that might reveal framework-specific signatures.
- **Analysing HTTP headers**: HTTP headers can sometimes contain information about the server and framework. Tools like Burp Suite or browser developer tools can be used to inspect these headers.
- **URL structure**: The structure of URLs can give hints about the framework. For instance, certain routing patterns are unique to specific frameworks.
- **Login and error pages**: Authentication pages and error messages can sometimes reveal the framework. Some frameworks have distinctive error pages or login form structures. 

