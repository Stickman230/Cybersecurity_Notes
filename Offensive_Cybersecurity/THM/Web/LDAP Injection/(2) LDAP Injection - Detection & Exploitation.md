
# Discovery

***LDAP Services*** can be accessible on ports :
- **389** (for unencrypted or StartTLS connections) 
- **636** (for SSL/TLS connections)

---
# Exploitation

## Common Attack Vectors

1. **Authentication Bypass:** Modifying LDAP authentication queries to log in as another user without knowing their password.
2. **Unauthorized Data Access:** Altering LDAP search queries to retrieve sensitive information not intended for the attacker's access.
3. **Data Manipulation:** Injecting queries that modify the LDAP directory, such as adding or modifying user attributes

## Authentication Bypass Techniques
### Tautology-Based Injection

A query fetching the username and password of a user for auth:
```php
(&(uid=USER)(userPassword=PASS))
```

Could be manipulated to always be true:
```php
(&(uid=*)(|(&)(userPassword=pwd)))
```

1. `(uid=*)`: This part of the filter matches any entry with a `uid` attribute, essentially all users, because the wildcard `*` matches any value.
2. `(|(&)(userPassword=pwd))`: The OR (`|`) operator, meaning that any of the two conditions enclosed needs to be true for the filter to pass. 
3. In LDAP, an empty AND (`(&)`) condition is always considered true. The other condition checks if the `userPassword` attribute matches the value `pwd`, which can fail if the user is not using `pwd` as their password.

### Wildcard Injection

Wildcards (`*`) are used in LDAP queries to match any sequence of characters
```php
(&(uid=USER)(userPassword=PASS))
```

Using a `*` for `{userInput}` and `{passwordInput}` does not validate the content of the password or user field against a specific expected value. Instead, it only **checks for the presence** of the `userPassword` attribute, regardless of its content.

### Blind LDAP Injection

#### Boolean-based Blind LDAP Injection.

Inject conditions into the username field to make the LDAP query true or false, observing the application's behaviour to infer information.

For example, an attacker might try injecting a username like `a*)(|(&`, which, when included in the LDAP query, checks for any user with "a" in their uid exists:

**Injected Username and Password:**

```bash
username=a*%29%28%7C%28%26&password=pwd%29
```
```bash
(&(uid=a*)(|(&)(userPassword=pwd))) 
```

If the application returns "Something is wrong in your password", the attacker can infer that a user with an account that starts with "a" in their uid exists in the LDAP directory.
##### Techniques for Extracting Information

1. **Boolean Exploitation:** This involves injecting conditions that are evaluated to be true or false and observing the application's response to infer data. For example, if the application behaves differently when the condition is true, the attacker can deduce that the injected condition matches an existing entry in the LDAP directory.
2. **Error-Based Inference:** In some cases, specific injections might trigger error messages or peculiar application behaviour, providing clues about the LDAP structure or confirming the success of particular payloads.